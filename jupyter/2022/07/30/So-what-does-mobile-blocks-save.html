<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>So what does does mobile blocks save | Akash’s Blog</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="So what does does mobile blocks save" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Writing of some technical stuff." />
<meta property="og:description" content="Writing of some technical stuff." />
<link rel="canonical" href="https://akashprakas.github.io/My-blog/jupyter/2022/07/30/So-what-does-mobile-blocks-save.html" />
<meta property="og:url" content="https://akashprakas.github.io/My-blog/jupyter/2022/07/30/So-what-does-mobile-blocks-save.html" />
<meta property="og:site_name" content="Akash’s Blog" />
<meta property="og:image" content="https://akashprakas.github.io/My-blog/images/chart-preview.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-07-30T00:00:00-05:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://akashprakas.github.io/My-blog/jupyter/2022/07/30/So-what-does-mobile-blocks-save.html"},"description":"Writing of some technical stuff.","@type":"BlogPosting","url":"https://akashprakas.github.io/My-blog/jupyter/2022/07/30/So-what-does-mobile-blocks-save.html","headline":"So what does does mobile blocks save","dateModified":"2022-07-30T00:00:00-05:00","datePublished":"2022-07-30T00:00:00-05:00","image":"https://akashprakas.github.io/My-blog/images/chart-preview.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/My-blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://akashprakas.github.io/My-blog/feed.xml" title="Akash's Blog" /><link rel="shortcut icon" type="image/x-icon" href="/My-blog/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>So what does does mobile blocks save | Akash’s Blog</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="So what does does mobile blocks save" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Writing of some technical stuff." />
<meta property="og:description" content="Writing of some technical stuff." />
<link rel="canonical" href="https://akashprakas.github.io/My-blog/jupyter/2022/07/30/So-what-does-mobile-blocks-save.html" />
<meta property="og:url" content="https://akashprakas.github.io/My-blog/jupyter/2022/07/30/So-what-does-mobile-blocks-save.html" />
<meta property="og:site_name" content="Akash’s Blog" />
<meta property="og:image" content="https://akashprakas.github.io/My-blog/images/chart-preview.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-07-30T00:00:00-05:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://akashprakas.github.io/My-blog/jupyter/2022/07/30/So-what-does-mobile-blocks-save.html"},"description":"Writing of some technical stuff.","@type":"BlogPosting","url":"https://akashprakas.github.io/My-blog/jupyter/2022/07/30/So-what-does-mobile-blocks-save.html","headline":"So what does does mobile blocks save","dateModified":"2022-07-30T00:00:00-05:00","datePublished":"2022-07-30T00:00:00-05:00","image":"https://akashprakas.github.io/My-blog/images/chart-preview.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://akashprakas.github.io/My-blog/feed.xml" title="Akash's Blog" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    // remove paragraph tags in rendered toc (happens from notebooks)
    var toctags = document.querySelectorAll(".toc-entry")
    toctags.forEach(e => (e.firstElementChild.innerText = e.firstElementChild.innerText.replace('¶', '')))
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/My-blog/">Akash&#39;s Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/My-blog/about/">About Me</a><a class="page-link" href="/My-blog/search/">Search</a><a class="page-link" href="/My-blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">So what does does mobile blocks save</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-07-30T00:00:00-05:00" itemprop="datePublished">
        Jul 30, 2022
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      7 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/My-blog/categories/#jupyter">jupyter</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/akashprakas/My-blog/tree/master/_notebooks/2022-07-30-So what does mobile blocks save.ipynb" role="button">
<img class="notebook-badge-image" src="/My-blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div><div class="px-2">
    <a href="https://colab.research.google.com/github/akashprakas/My-blog/blob/master/_notebooks/2022-07-30-So what does mobile blocks save.ipynb">
        <img class="notebook-badge-image" src="/My-blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#Brief-Intro">Brief Intro </a></li>
<li class="toc-entry toc-h1"><a href="#Simple-ConvNet-Block">Simple ConvNet Block </a></li>
<li class="toc-entry toc-h1"><a href="#MobileNet-Block">MobileNet Block </a></li>
<li class="toc-entry toc-h1"><a href="#MobileNetv2-Block">MobileNetv2 Block </a></li>
<li class="toc-entry toc-h1"><a href="#Comparison">Comparison </a>
<ul>
<li class="toc-entry toc-h4"><a href="#1)SimpleConvBlock">1)SimpleConvBlock </a></li>
<li class="toc-entry toc-h4"><a href="#2)MobileNetV1">2)MobileNetV1 </a></li>
<li class="toc-entry toc-h4"><a href="#3)MobileNetV2">3)MobileNetV2 </a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#Doing-all-the-above-with-torchvision-classes">Doing all the above with torchvision classes </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-07-30-So what does mobile blocks save.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Brief-Intro">
<a class="anchor" href="#Brief-Intro" aria-hidden="true"><span class="octicon octicon-link"></span></a>Brief Intro<a class="anchor-link" href="#Brief-Intro"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This blog assumes the reader have a some understanding of mobileNet.This is just a lazy illustration of how much different mobileNet block save. The actual papers have the real numbers. If you want to know about the model please go through the papers <a href="https://arxiv.org/abs/1704.04861">MobileNetV1</a> <a href="https://arxiv.org/abs/1801.04381">MobileNetV2</a>. In this we will briefly see how much parameters and floating point operations are required by a normal convolution block, mobileNetV1 and mobileNetV2 for the same input size to produce the same output. We will use torchinfo library for getting the summaries.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse-hide</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">from</span> <span class="nn">torchinfo</span> <span class="kn">import</span> <span class="n">summary</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># we will use the same input and outputs for all the conv blocks and mobile blocks</span>
<span class="n">input_filters</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">output_filters</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">input_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">input_filters</span><span class="p">,</span><span class="mi">224</span><span class="p">,</span><span class="mi">224</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse-hide</span>
<span class="k">def</span> <span class="nf">printInputAndOutput</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">input_filters</span><span class="o">=</span><span class="mi">64</span><span class="p">):</span>
    <span class="n">rand_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="n">input_filters</span><span class="p">,</span><span class="mi">224</span><span class="p">,</span><span class="mi">224</span><span class="p">))</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">rand_tensor</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Input shape = "</span><span class="p">,</span> <span class="n">rand_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Output shap ="</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Simple-ConvNet-Block">
<a class="anchor" href="#Simple-ConvNet-Block" aria-hidden="true"><span class="octicon octicon-link"></span></a>Simple ConvNet Block<a class="anchor-link" href="#Simple-ConvNet-Block"> </a>
</h1>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">simple_convBlock</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="n">input_filters</span><span class="p">,</span><span class="n">out_channels</span><span class="o">=</span><span class="n">output_filters</span><span class="p">,</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                          <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">output_filters</span><span class="p">),</span>
                                <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">printInputAndOutput</span><span class="p">(</span><span class="n">simple_convBlock</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Input shape =  torch.Size([3, 64, 224, 224])
Output shap = torch.Size([3, 128, 112, 112])
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">summary</span><span class="p">(</span><span class="n">simple_convBlock</span><span class="p">,</span><span class="n">input_size</span><span class="o">=</span><span class="n">input_size</span><span class="p">,</span><span class="n">col_names</span><span class="o">=</span><span class="p">[</span><span class="s2">"kernel_size"</span><span class="p">,</span> <span class="s2">"output_size"</span><span class="p">,</span> <span class="s2">"num_params"</span><span class="p">,</span> <span class="s2">"mult_adds"</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>============================================================================================================================================
Layer (type:depth-idx)                   Kernel Shape              Output Shape              Param #                   Mult-Adds
============================================================================================================================================
Sequential                               --                        [3, 128, 112, 112]        --                        --
├─Conv2d: 1-1                            [3, 3]                    [3, 128, 112, 112]        73,728                    2,774,532,096
├─BatchNorm2d: 1-2                       --                        [3, 128, 112, 112]        256                       768
├─ReLU: 1-3                              --                        [3, 128, 112, 112]        --                        --
============================================================================================================================================
Total params: 73,984
Trainable params: 73,984
Non-trainable params: 0
Total mult-adds (G): 2.77
============================================================================================================================================
Input size (MB): 38.54
Forward/backward pass size (MB): 77.07
Params size (MB): 0.30
Estimated Total Size (MB): 115.90
============================================================================================================================================</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="MobileNet-Block">
<a class="anchor" href="#MobileNet-Block" aria-hidden="true"><span class="octicon octicon-link"></span></a>MobileNet Block<a class="anchor-link" href="#MobileNet-Block"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The main idea is to use depth wise convolution to reduce the parameters and floating point operations required. For more info please read the paper or watch this <a href="https://www.youtube.com/watch?v=GAbQYns1j2M">tutorial</a> by Prof Maziar Raissi</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mobileNetBlock</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
                <span class="c1">#DEPTHWISE CONV</span>
                <span class="c1">#we get the depthwise convolution by specifying groups same as in_channels</span>
                <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="n">input_filters</span><span class="p">,</span><span class="n">out_channels</span><span class="o">=</span><span class="n">input_filters</span><span class="p">,</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                         <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">groups</span><span class="o">=</span><span class="n">input_filters</span><span class="p">,</span><span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">input_filters</span><span class="p">),</span>
                <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    
                <span class="c1">#POINTWISE CONV</span>
                <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="n">input_filters</span><span class="p">,</span><span class="n">out_channels</span><span class="o">=</span><span class="n">output_filters</span><span class="p">,</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">output_filters</span><span class="p">),</span>
                <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="p">)</span>
<span class="n">printInputAndOutput</span><span class="p">(</span><span class="n">mobileNetBlock</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Input shape =  torch.Size([3, 64, 224, 224])
Output shap = torch.Size([3, 128, 112, 112])
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">summary</span><span class="p">(</span><span class="n">mobileNetBlock</span><span class="p">,</span><span class="n">input_size</span><span class="o">=</span><span class="n">input_size</span><span class="p">,</span><span class="n">col_names</span><span class="o">=</span><span class="p">[</span><span class="s2">"kernel_size"</span><span class="p">,</span> <span class="s2">"output_size"</span><span class="p">,</span> <span class="s2">"num_params"</span><span class="p">,</span> <span class="s2">"mult_adds"</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>============================================================================================================================================
Layer (type:depth-idx)                   Kernel Shape              Output Shape              Param #                   Mult-Adds
============================================================================================================================================
Sequential                               --                        [3, 128, 112, 112]        --                        --
├─Conv2d: 1-1                            [3, 3]                    [3, 64, 112, 112]         576                       21,676,032
├─BatchNorm2d: 1-2                       --                        [3, 64, 112, 112]         128                       384
├─ReLU: 1-3                              --                        [3, 64, 112, 112]         --                        --
├─Conv2d: 1-4                            [1, 1]                    [3, 128, 112, 112]        8,192                     308,281,344
├─BatchNorm2d: 1-5                       --                        [3, 128, 112, 112]        256                       768
├─ReLU: 1-6                              --                        [3, 128, 112, 112]        --                        --
============================================================================================================================================
Total params: 9,152
Trainable params: 9,152
Non-trainable params: 0
Total mult-adds (M): 329.96
============================================================================================================================================
Input size (MB): 38.54
Forward/backward pass size (MB): 115.61
Params size (MB): 0.04
Estimated Total Size (MB): 154.18
============================================================================================================================================</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="MobileNetv2-Block">
<a class="anchor" href="#MobileNetv2-Block" aria-hidden="true"><span class="octicon octicon-link"></span></a>MobileNetv2 Block<a class="anchor-link" href="#MobileNetv2-Block"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The idea here is to add a residual connection and with this better perfomance was obtained with a slight increase in number of parameters. For more info please read the paper or watch this <a href="https://www.youtube.com/watch?v=hzj9kEU8QdA">tutorial</a> by Prof Maziar Raissi</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">MobileNetv2Block</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">in_channels</span><span class="p">,</span><span class="n">out_channels</span><span class="p">,</span><span class="n">expand_ratio</span><span class="p">,</span><span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MobileNetv2Block</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv1x1Begin</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="p">,</span><span class="n">in_channels</span><span class="o">*</span><span class="n">expand_ratio</span><span class="p">,</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">*</span><span class="n">expand_ratio</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU6</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">convDepthWise</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">*</span><span class="n">expand_ratio</span><span class="p">,</span><span class="n">in_channels</span><span class="o">*</span><span class="n">expand_ratio</span><span class="p">,</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">groups</span><span class="o">=</span><span class="n">in_channels</span><span class="o">*</span><span class="n">expand_ratio</span><span class="p">,</span><span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">*</span><span class="n">expand_ratio</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU6</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">conv1x1Last</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">*</span><span class="n">expand_ratio</span><span class="p">,</span><span class="n">out_channels</span><span class="p">,</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">out_channels</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU6</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">stride</span> <span class="o">=</span> <span class="n">stride</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">use_res_connect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stride</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">in_channels</span> <span class="o">==</span> <span class="n">out_channels</span>
        
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
        <span class="n">input_</span> <span class="o">=</span> <span class="n">x</span>     
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv1x1Begin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convDepthWise</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv1x1Last</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_res_connect</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">input_</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span>
        
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mobileNetV2Block</span> <span class="o">=</span> <span class="n">MobileNetv2Block</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">printInputAndOutput</span><span class="p">(</span><span class="n">mobileNetV2Block</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Input shape =  torch.Size([3, 64, 224, 224])
Output shap = torch.Size([3, 128, 112, 112])
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">summary</span><span class="p">(</span><span class="n">mobileNetV2Block</span><span class="p">,</span><span class="n">input_size</span><span class="o">=</span><span class="n">input_size</span><span class="p">,</span><span class="n">col_names</span><span class="o">=</span><span class="p">[</span><span class="s2">"kernel_size"</span><span class="p">,</span> <span class="s2">"output_size"</span><span class="p">,</span> <span class="s2">"num_params"</span><span class="p">,</span> <span class="s2">"mult_adds"</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>============================================================================================================================================
Layer (type:depth-idx)                   Kernel Shape              Output Shape              Param #                   Mult-Adds
============================================================================================================================================
MobileNetv2Block                         --                        [3, 128, 112, 112]        --                        --
├─Sequential: 1-1                        --                        [3, 128, 224, 224]        --                        --
│    └─Conv2d: 2-1                       [1, 1]                    [3, 128, 224, 224]        8,192                     1,233,125,376
│    └─BatchNorm2d: 2-2                  --                        [3, 128, 224, 224]        256                       768
│    └─ReLU6: 2-3                        --                        [3, 128, 224, 224]        --                        --
├─Sequential: 1-2                        --                        [3, 128, 112, 112]        --                        --
│    └─Conv2d: 2-4                       [3, 3]                    [3, 128, 112, 112]        1,152                     43,352,064
│    └─BatchNorm2d: 2-5                  --                        [3, 128, 112, 112]        256                       768
│    └─ReLU6: 2-6                        --                        [3, 128, 112, 112]        --                        --
├─Sequential: 1-3                        --                        [3, 128, 112, 112]        --                        --
│    └─Conv2d: 2-7                       [1, 1]                    [3, 128, 112, 112]        16,384                    616,562,688
│    └─BatchNorm2d: 2-8                  --                        [3, 128, 112, 112]        256                       768
│    └─ReLU6: 2-9                        --                        [3, 128, 112, 112]        --                        --
============================================================================================================================================
Total params: 26,496
Trainable params: 26,496
Non-trainable params: 0
Total mult-adds (G): 1.89
============================================================================================================================================
Input size (MB): 38.54
Forward/backward pass size (MB): 462.42
Params size (MB): 0.11
Estimated Total Size (MB): 501.06
============================================================================================================================================</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Comparison">
<a class="anchor" href="#Comparison" aria-hidden="true"><span class="octicon octicon-link"></span></a>Comparison<a class="anchor-link" href="#Comparison"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can compare the summaries of each block. From the above cells we can observe that the inputs and output shapes remains the same</p>
<h4 id="1)SimpleConvBlock">
<a class="anchor" href="#1)SimpleConvBlock" aria-hidden="true"><span class="octicon octicon-link"></span></a>1)SimpleConvBlock<a class="anchor-link" href="#1)SimpleConvBlock"> </a>
</h4>
<p><code>Total params: 73,984</code></p>
<p><code>Trainable params: 73,984</code></p>
<p><code>Non-trainable params: 0</code></p>
<p><code>Total mult-adds (G): 2.77</code></p>
<h4 id="2)MobileNetV1">
<a class="anchor" href="#2)MobileNetV1" aria-hidden="true"><span class="octicon octicon-link"></span></a>2)MobileNetV1<a class="anchor-link" href="#2)MobileNetV1"> </a>
</h4>
<p><code>Total params: 9,152</code></p>
<p><code>Trainable params: 9,152</code></p>
<p><code>Non-trainable params: 0</code></p>
<p><code>Total mult-adds (M): 329.96</code></p>
<h4 id="3)MobileNetV2">
<a class="anchor" href="#3)MobileNetV2" aria-hidden="true"><span class="octicon octicon-link"></span></a>3)MobileNetV2<a class="anchor-link" href="#3)MobileNetV2"> </a>
</h4>
<p><code>Total params: 26,496</code></p>
<p><code>Trainable params: 26,496</code></p>
<p><code>Non-trainable params: 0</code></p>
<p><code>Total mult-adds (G): 1.89</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you look at the outputs of torchinfo you can see that the estimated total size is more for mobileNets than simpleConv block this isbecause we need to store 2 times the intermediate values during training  , but this wont be a problem for inference, during inference we only need to store the parameters and architecture, and thus looking above we can see that way fewer parameters and total number of multiplications and additions needed is also low which helps in faster inference. If you want more info please read the papers which are well written. If you want to read about how the torchinfo works please read this <a href="http://jck.bio/pytorch_estimating_model_size/">blog</a> by Jacob C. Kimmel</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Doing-all-the-above-with-torchvision-classes">
<a class="anchor" href="#Doing-all-the-above-with-torchvision-classes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Doing all the above with torchvision classes<a class="anchor-link" href="#Doing-all-the-above-with-torchvision-classes"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Actually all the above were taken from torchvision only and we can do the same easily with torchvision classes as shown below . All credits are to the amazing torchvision library</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">torchvision.models.mobilenetv2</span> <span class="kn">import</span> <span class="n">MobileNetV2</span><span class="p">,</span> <span class="n">InvertedResidual</span><span class="p">,</span><span class="n">ConvNormActivation</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#we have to put the expand_ratio as one which will reduce this to a simple mobilenetV1 block</span>
<span class="n">TorchMobileNetV1Block</span> <span class="o">=</span> <span class="n">InvertedResidual</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">expand_ratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">TorchMobileNetV2Block</span> <span class="o">=</span> <span class="n">InvertedResidual</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">expand_ratio</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">printInputAndOutput</span><span class="p">(</span><span class="n">TorchMobileNetV1Block</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Input shape =  torch.Size([3, 64, 224, 224])
Output shap = torch.Size([3, 128, 112, 112])
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">printInputAndOutput</span><span class="p">(</span><span class="n">TorchMobileNetV2Block</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Input shape =  torch.Size([3, 64, 224, 224])
Output shap = torch.Size([3, 128, 112, 112])
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">summary</span><span class="p">(</span><span class="n">TorchMobileNetV1Block</span><span class="p">,</span><span class="n">input_size</span><span class="o">=</span><span class="n">input_size</span><span class="p">,</span><span class="n">col_names</span><span class="o">=</span><span class="p">[</span><span class="s2">"kernel_size"</span><span class="p">,</span> <span class="s2">"output_size"</span><span class="p">,</span> <span class="s2">"num_params"</span><span class="p">,</span> <span class="s2">"mult_adds"</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>============================================================================================================================================
Layer (type:depth-idx)                   Kernel Shape              Output Shape              Param #                   Mult-Adds
============================================================================================================================================
InvertedResidual                         --                        [3, 128, 112, 112]        --                        --
├─Sequential: 1-1                        --                        [3, 128, 112, 112]        --                        --
│    └─ConvNormActivation: 2-1           --                        [3, 64, 112, 112]         --                        --
│    │    └─Conv2d: 3-1                  [3, 3]                    [3, 64, 112, 112]         576                       21,676,032
│    │    └─BatchNorm2d: 3-2             --                        [3, 64, 112, 112]         128                       384
│    │    └─ReLU6: 3-3                   --                        [3, 64, 112, 112]         --                        --
│    └─Conv2d: 2-2                       [1, 1]                    [3, 128, 112, 112]        8,192                     308,281,344
│    └─BatchNorm2d: 2-3                  --                        [3, 128, 112, 112]        256                       768
============================================================================================================================================
Total params: 9,152
Trainable params: 9,152
Non-trainable params: 0
Total mult-adds (M): 329.96
============================================================================================================================================
Input size (MB): 38.54
Forward/backward pass size (MB): 115.61
Params size (MB): 0.04
Estimated Total Size (MB): 154.18
============================================================================================================================================</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">summary</span><span class="p">(</span><span class="n">TorchMobileNetV2Block</span><span class="p">,</span><span class="n">input_size</span><span class="o">=</span><span class="n">input_size</span><span class="p">,</span><span class="n">col_names</span><span class="o">=</span><span class="p">[</span><span class="s2">"kernel_size"</span><span class="p">,</span> <span class="s2">"output_size"</span><span class="p">,</span> <span class="s2">"num_params"</span><span class="p">,</span> <span class="s2">"mult_adds"</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>============================================================================================================================================
Layer (type:depth-idx)                   Kernel Shape              Output Shape              Param #                   Mult-Adds
============================================================================================================================================
InvertedResidual                         --                        [3, 128, 112, 112]        --                        --
├─Sequential: 1-1                        --                        [3, 128, 112, 112]        --                        --
│    └─ConvNormActivation: 2-1           --                        [3, 128, 224, 224]        --                        --
│    │    └─Conv2d: 3-1                  [1, 1]                    [3, 128, 224, 224]        8,192                     1,233,125,376
│    │    └─BatchNorm2d: 3-2             --                        [3, 128, 224, 224]        256                       768
│    │    └─ReLU6: 3-3                   --                        [3, 128, 224, 224]        --                        --
│    └─ConvNormActivation: 2-2           --                        [3, 128, 112, 112]        --                        --
│    │    └─Conv2d: 3-4                  [3, 3]                    [3, 128, 112, 112]        1,152                     43,352,064
│    │    └─BatchNorm2d: 3-5             --                        [3, 128, 112, 112]        256                       768
│    │    └─ReLU6: 3-6                   --                        [3, 128, 112, 112]        --                        --
│    └─Conv2d: 2-3                       [1, 1]                    [3, 128, 112, 112]        16,384                    616,562,688
│    └─BatchNorm2d: 2-4                  --                        [3, 128, 112, 112]        256                       768
============================================================================================================================================
Total params: 26,496
Trainable params: 26,496
Non-trainable params: 0
Total mult-adds (G): 1.89
============================================================================================================================================
Input size (MB): 38.54
Forward/backward pass size (MB): 462.42
Params size (MB): 0.11
Estimated Total Size (MB): 501.06
============================================================================================================================================</pre>
</div>

</div>

</div>
</div>

</div>
    

</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="akashprakas/My-blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/My-blog/jupyter/2022/07/30/So-what-does-mobile-blocks-save.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/My-blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/My-blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/My-blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Writing of some technical stuff.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://twitter.com/akashaapz" target="_blank" title="akashaapz"><svg class="svg-icon grey"><use xlink:href="/My-blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
